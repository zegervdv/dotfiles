name: Environment build test

on:
  push:

jobs:
  install:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Homebrew
        uses: Homebrew/actions/setup-homebrew@master

      - name: Install chezmoi
        run: brew install chezmoi

      - name: Bootstrap environment
        run: |
          mkdir -p $HOME/.config/chezmoi/
          mkdir -p $HOME/.local/share
          touch $HOME/.config/chezmoi/chezmoi.toml
          echo '  [data]' >> $HOME/.config/chezmoi/chezmoi.toml
          echo '    email = "john.doe@example.com"' >> $HOME/.config/chezmoi/chezmoi.toml
          echo '    name = "jdoe"' >> $HOME/.config/chezmoi/chezmoi.toml
          echo '    signingkey = "" ' >> $HOME/.config/chezmoi/chezmoi.toml
          echo '    font_size = "10"' >> $HOME/.config/chezmoi/chezmoi.toml
          
      - name: Get repo
        uses: actions/checkout@v2
        with:
          path: ${{ env.HOME }}/.local/share/chezmoi

      - name: Initialize chezmoi
        run: chezmoi init -v

      - name: add tap manually
        run: brew tap zegervdv/tools
        
      - name: Apply dotfiles
        run: chezmoi apply -v
